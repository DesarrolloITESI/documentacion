# üõí API Ecommerce - Documentaci√≥n Completa

**Versi√≥n:** 1.0.0 | **Fecha:** Octubre 2025 | **Protocolo:** REST API

## üåê URLs del API

- **üöÄ Producci√≥n:** `https://pruebas-api-l4yu.onrender.com/api`
- **üõ†Ô∏è Desarrollo:** `https://pruebas-api-l4yu.onrender.com/api`

---

## üìã Tabla de Contenido

1. [Introducci√≥n](#introducci√≥n)
2. [Configuraci√≥n Inicial](#configuraci√≥n-inicial)
3. [Autenticaci√≥n](#autenticaci√≥n)
4. [Endpoints de √ìrdenes](#endpoints-de-√≥rdenes)
5. [Endpoints de Productos](#endpoints-de-productos)
6. [Filtros y Par√°metros](#filtros-y-par√°metros)
7. [Ejemplos Pr√°cticos](#ejemplos-pr√°cticos)
8. [Manejo de Errores](#manejo-de-errores)
9. [Herramientas de Prueba](#herramientas-de-prueba)

---

## 1. üìñ Introducci√≥n

La **API Ecommerce** es una interfaz RESTful dise√±ada para gestionar √≥rdenes y productos en plataformas de comercio electr√≥nico. Proporciona funcionalidades completas para:

- üîê **Autenticaci√≥n segura** con tokens JWT
- üì¶ **Gesti√≥n de √≥rdenes** con filtros avanzados
- üõçÔ∏è **Administraci√≥n de productos** por SKU
- üìä **Exportaci√≥n de datos** a diferentes formatos
- üîí **Seguridad integrada** con rate limiting

### Informaci√≥n B√°sica
- **üåê URL Base:** `https://pruebas-api-l4yu.onrender.com/api`
- **üìã Formato:** JSON
- **üîë Autenticaci√≥n:** Bearer Token (JWT)
- **‚è±Ô∏è Rate Limit:** 1 petici√≥n por segundo por IP

---

## 2. ‚öôÔ∏è Configuraci√≥n Inicial

### üìã Requisitos Previos
- Servidor API ejecut√°ndose en `http://localhost:3000`
- Herramienta para hacer peticiones HTTP (curl, Postman, etc.)
- Token de autenticaci√≥n v√°lido

### üîß Headers Requeridos

| Header | Valor | Descripci√≥n |
|--------|-------|-------------|
| `Content-Type` | application/json | Para peticiones con body (POST, PUT) |
| `Authorization` | Bearer {token} | Token JWT para endpoints protegidos |

---

## 3. üîê Autenticaci√≥n

La API utiliza **JSON Web Tokens (JWT)** para autenticaci√≥n. Los tokens tienen una duraci√≥n de **30 minutos** y deben incluirse en el header Authorization de todas las peticiones protegidas.

### üîë Obtener Token de Acceso

**Endpoint:** `POST /api/auth/token`

**Descripci√≥n:** Genera un nuevo token de acceso JWT v√°lido por 30 minutos.

**Petici√≥n:**
```bash
curl -X POST https://pruebas-api-l4yu.onrender.com/api/auth/token
```

**Respuesta Exitosa:**
```json
{
  "success": true,
  "message": "Token de acceso generado exitosamente",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "Bearer",
    "expires_in": 1800,
    "expires_at": "2025-10-01T05:30:00.000Z",
    "scope": "api_access"
  }
}
```

### ‚úÖ Verificar Token

**Endpoint:** `POST /api/auth/verify`

**Petici√≥n:**
```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  https://pruebas-api-l4yu.onrender.com/api/auth/verify
```

> ‚ö†Ô∏è **Importante:**
> - Guarda el token de forma segura
> - Los tokens expiran cada 30 minutos
> - Genera un nuevo token antes de que expire el actual
> - No compartas tokens entre diferentes usuarios

---

## 4. üì¶ Endpoints de √ìrdenes

### üìã Obtener √ìrdenes

**Endpoint:** `GET /api/orders`

**Descripci√≥n:** Obtiene una lista de √≥rdenes con sus detalles completos. Soporta filtros avanzados y paginaci√≥n.

#### üîß Par√°metros de Query (Opcionales)

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `id_venta` | number | ID espec√≠fico de la venta | 123 |
| `fecha_inicial` | date | Fecha de inicio (ISO 8601) | 2025-01-01 |
| `fecha_final` | date | Fecha de fin (ISO 8601) | 2025-01-31 |
| `plataforma` | string | Plataforma de venta | AMAZON, WALMART, LIVERPOOL, MELI, SEARS |
| `limit` | number | N√∫mero m√°ximo de resultados | 50 (defecto) |
| `offset` | number | N√∫mero de registros a omitir | 0 (defecto) |

#### üì§ Ejemplos de Peticiones

```bash
# Obtener todas las √≥rdenes
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://pruebas-api-l4yu.onrender.com/api/orders

# Filtrar por plataforma
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?plataforma=AMAZON"

# Filtrar por rango de fechas
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?fecha_inicial=2025-01-01&fecha_final=2025-01-31"

# Paginaci√≥n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?limit=10&offset=20"
```

#### üì• Respuesta Exitosa

```json
{
  "success": true,
  "message": "√ìrdenes obtenidas exitosamente",
  "data": [
    {
      "id_venta": 10,
      "fecha": "2025-09-30T16:45:00.000Z",
      "plataforma": "AMAZON",
      "total": "1500.00",
      "estado": "COMPLETADA",
      "detalle": [
        {
          "id_detalle": 10,
          "sku": "SKU010",
          "cantidad": 1,
          "precio_unitario": "1500.00",
          "subtotal": "1500.00",
          "producto": {
            "nombre": "Producto 10",
            "descripcion": "Descripci√≥n del producto 10"
          }
        }
      ]
    }
  ],
  "count": 1,
  "filters": {
    "limit": 50,
    "offset": 0
  }
}
```

### üîÑ Actualizar Estado de Orden

**Endpoint:** `PUT /api/orders/{id_venta}`

**Descripci√≥n:** Actualiza el estado de una orden espec√≠fica.

#### üéØ Par√°metros de URL
| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `id_venta` | number | ID √∫nico de la venta a actualizar |

#### üìã Body de la Petici√≥n
| Campo | Tipo | Requerido | Valores Permitidos |
|-------|------|-----------|-------------------|
| `estado` | string | S√≠ | pendiente, procesando, enviado, entregado, cancelado |

#### üì§ Ejemplo de Petici√≥n
```bash
curl -X PUT \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"estado": "enviado"}' \
  https://pruebas-api-l4yu.onrender.com/api/orders/123
```

### üìä Exportar √ìrdenes

**Endpoint:** `GET /api/orders/excel`

**Descripci√≥n:** Obtiene los datos de √≥rdenes en formato plano para exportaci√≥n (sin JSON anidado).

#### üì§ Ejemplo de Petici√≥n
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders/excel?limit=100"
```

> üí° **Nota:** Este endpoint devuelve los datos en estructura plana, ideal para generar reportes en Excel o CSV. Acepta los mismos filtros que el endpoint principal de √≥rdenes.

---

## 5. üõçÔ∏è Endpoints de Productos

### üìã Obtener Productos

**Endpoint:** `GET /api/products`

**Descripci√≥n:** Obtiene una lista de productos con filtros opcionales y paginaci√≥n.

#### üîß Par√°metros de Query (Opcionales)

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `sku` | string | SKU espec√≠fico del producto | SKU001 |
| `nombre` | string | B√∫squeda por nombre (parcial) | laptop |
| `limit` | number | N√∫mero m√°ximo de resultados | 50 (defecto) |
| `offset` | number | N√∫mero de registros a omitir | 0 (defecto) |

#### üì§ Ejemplos de Peticiones

```bash
# Obtener todos los productos
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://pruebas-api-l4yu.onrender.com/api/products

# Buscar por nombre
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/products?nombre=laptop"

# Buscar por SKU espec√≠fico
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/products?sku=SKU001"
```

### üîç Obtener Producto por SKU

**Endpoint:** `GET /api/products/{sku}`

**Descripci√≥n:** Obtiene los detalles de un producto espec√≠fico usando su SKU.

#### üì§ Ejemplo de Petici√≥n
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://pruebas-api-l4yu.onrender.com/api/products/SKU001
```

### ‚úèÔ∏è Actualizar Producto

**Endpoint:** `PUT /api/products/{sku}`

**Descripci√≥n:** Actualiza el nombre y/o descripci√≥n de un producto espec√≠fico.

#### üìã Body de la Petici√≥n
| Campo | Tipo | Requerido | Descripci√≥n |
|-------|------|-----------|-------------|
| `nombre` | string | No | Nuevo nombre del producto (m√°x. 255 caracteres) |
| `descripcion` | string | No | Nueva descripci√≥n del producto (m√°x. 1000 caracteres) |

#### üì§ Ejemplo de Petici√≥n
```bash
curl -X PUT \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Laptop Dell Inspiron 15 - Edici√≥n 2025",
    "descripcion": "Nueva laptop con especificaciones mejoradas"
  }' \
  https://pruebas-api-l4yu.onrender.com/api/products/SKU001
```

> üí° **Nota:** Puedes actualizar solo el nombre, solo la descripci√≥n, o ambos campos. Al menos uno debe estar presente en la petici√≥n.

---

## 6. üîç Filtros y Par√°metros Detallados

### üìÖ Filtros de Fecha

Los filtros de fecha utilizan el formato ISO 8601 y pueden combinarse para crear rangos:

| Combinaci√≥n | Descripci√≥n | Ejemplo |
|-------------|-------------|---------|
| Solo `fecha_inicial` | √ìrdenes desde esa fecha en adelante | ?fecha_inicial=2025-01-01 |
| Solo `fecha_final` | √ìrdenes hasta esa fecha | ?fecha_final=2025-01-31 |
| Ambas fechas | √ìrdenes dentro del rango | ?fecha_inicial=2025-01-01&fecha_final=2025-01-31 |

### üè™ Filtro de Plataforma

El filtro de plataforma utiliza b√∫squeda parcial (ILIKE), por lo que puedes buscar:
- **Exacto:** `?plataforma=AMAZON`
- **Parcial:** `?plataforma=AMZ` (encontrar√° AMAZON)
- **Case-insensitive:** `?plataforma=amazon`

### üìä Paginaci√≥n

Todos los endpoints que devuelven listas soportan paginaci√≥n:

```bash
# Primera p√°gina (20 productos)
?limit=20&offset=0

# Segunda p√°gina (20 productos)
?limit=20&offset=20

# Tercera p√°gina (20 productos)
?limit=20&offset=40
```

### üîó Combinando Filtros

Puedes combinar m√∫ltiples filtros en una sola petici√≥n:

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?plataforma=AMAZON&fecha_inicial=2025-01-01&limit=10"
```

> ‚ö†Ô∏è **L√≠mites y Restricciones:**
> - **L√≠mite m√°ximo:** 1000 registros por petici√≥n
> - **Rate limit:** 1 petici√≥n por segundo por IP
> - **Timeout:** 30 segundos por petici√≥n
> - **Token expiry:** 30 minutos

---

## 7. üí° Ejemplos Pr√°cticos

### üöÄ Flujo Completo de Uso

#### Paso 1: Obtener Token
```bash
# Obtener token de acceso
TOKEN=$(curl -s -X POST https://pruebas-api-l4yu.onrender.com/api/auth/token | jq -r '.data.access_token')
echo "Token obtenido: $TOKEN"
```

#### Paso 2: Consultar √ìrdenes
```bash
# Obtener √≥rdenes recientes
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?limit=5" | jq .
```

#### Paso 3: Filtrar por Plataforma
```bash
# √ìrdenes de Amazon del √∫ltimo mes
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?plataforma=AMAZON&fecha_inicial=2025-09-01" | jq .
```

#### Paso 4: Actualizar Estado
```bash
# Marcar orden como enviada
curl -X PUT \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"estado": "enviado"}' \
  https://pruebas-api-l4yu.onrender.com/api/orders/123 | jq .
```

### üìà Casos de Uso Comunes

#### üîç Buscar √ìrdenes por ID
```bash
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?id_venta=123"
```

#### üìÖ √ìrdenes del D√≠a Actual
```bash
TODAY=$(date +%Y-%m-%d)
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders?fecha_inicial=${TODAY}&fecha_final=${TODAY}"
```

#### üõçÔ∏è Buscar Producto por Nombre
```bash
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/products?nombre=laptop"
```

#### üìä Exportar Datos para Reporte
```bash
curl -H "Authorization: Bearer $TOKEN" \
  "https://pruebas-api-l4yu.onrender.com/api/orders/excel?fecha_inicial=2025-01-01&fecha_final=2025-01-31" \
  > reporte_enero.json
```

### üîÑ Script de Automatizaci√≥n

```bash
#!/bin/bash

# Script para obtener reporte diario
API_BASE="https://pruebas-api-l4yu.onrender.com/api"
TODAY=$(date +%Y-%m-%d)

# Obtener token
TOKEN=$(curl -s -X POST "$API_BASE/auth/token" | jq -r '.data.access_token')

# Obtener √≥rdenes del d√≠a
curl -s -H "Authorization: Bearer $TOKEN" \
  "$API_BASE/orders?fecha_inicial=$TODAY&fecha_final=$TODAY" \
  | jq '.data | length' > ordenes_hoy.txt

echo "√ìrdenes procesadas hoy: $(cat ordenes_hoy.txt)"
```

---

## 8. ‚ö†Ô∏è Manejo de Errores

### üìã C√≥digos de Estado HTTP

| C√≥digo | Descripci√≥n | Causa Com√∫n |
|--------|-------------|-------------|
| **200** | √âxito | Petici√≥n procesada correctamente |
| **400** | Bad Request | Par√°metros inv√°lidos o faltantes |
| **401** | Unauthorized | Token faltante, inv√°lido o expirado |
| **404** | Not Found | Recurso no encontrado |
| **429** | Too Many Requests | Rate limit excedido |
| **500** | Internal Server Error | Error del servidor |

### üîç Formato de Respuestas de Error

#### Ejemplo de Error 401 (Token Expirado)
```json
{
  "success": false,
  "message": "Token expirado",
  "error": "El token ha caducado, solicite uno nuevo"
}
```

#### Ejemplo de Error 400 (Par√°metros Inv√°lidos)
```json
{
  "success": false,
  "message": "Par√°metros de consulta inv√°lidos",
  "error": "\"limit\" must be less than or equal to 1000"
}
```

#### Ejemplo de Error 429 (Rate Limit)
```json
{
  "success": false,
  "message": "Demasiadas peticiones desde esta IP",
  "error": "Por favor intente de nuevo m√°s tarde"
}
```

### üõ†Ô∏è Soluci√≥n de Problemas Comunes

> ‚ùå **Error: "Token expirado"**  
> **Soluci√≥n:** Generar un nuevo token usando `POST /api/auth/token`

> ‚ùå **Error: "Rate limit exceeded"**  
> **Soluci√≥n:** Esperar 1 segundo entre peticiones o implementar retry con backoff

> ‚ùå **Error: "Producto no encontrado"**  
> **Soluci√≥n:** Verificar que el SKU existe usando `GET /api/products`

---

## 9. üß™ Herramientas de Prueba

### üíª Usando curl

curl es la herramienta de l√≠nea de comandos m√°s vers√°til para probar APIs:

```bash
# Configurar variables
export API_BASE="https://pruebas-api-l4yu.onrender.com/api"
export TOKEN="your_token_here"

# Funci√≥n helper para peticiones autenticadas
api_get() {
  curl -H "Authorization: Bearer $TOKEN" "$API_BASE/$1"
}

# Uso
api_get "products?limit=5"
```

### üì± Usando Postman

1. Crear una nueva colecci√≥n "Ecommerce API"
2. Configurar variable de entorno `{{base_url}}` = `https://pruebas-api-l4yu.onrender.com/api`
3. Configurar variable de entorno `{{token}}` con tu JWT
4. Agregar header global: `Authorization: Bearer {{token}}`

### üîß Health Check

Siempre puedes verificar que la API est√© funcionando:

```bash
curl https://pruebas-api-l4yu.onrender.com/api/health
```

### üìä Collection de Postman

Se incluye una collection de Postman pre-configurada con todos los endpoints en el archivo `postman-collection.json` del proyecto.

**Para importar:**
1. Abrir Postman
2. File ‚Üí Import
3. Seleccionar `postman-collection.json`
4. Configurar variables de entorno

### üêõ Debug y Logging

La API incluye logging detallado que puedes monitorear en la consola del servidor:
- üîµ **Azul:** Peticiones entrantes
- üü¢ **Verde:** Operaciones exitosas
- üî¥ **Rojo:** Errores
- üü° **Amarillo:** Advertencias

---

## üìû Soporte

**üõí API Ecommerce v1.0.0**

Documentaci√≥n generada el **Octubre 2025**

Para soporte t√©cnico o consultas, contacta al equipo de desarrollo.